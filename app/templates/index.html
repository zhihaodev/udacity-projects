{% extends "base.html" %}


{% block styles %}
{{ super() }}
<style>
#categories .panel-heading {
  height: 80px;
  line-height: 60px;
  overflow: hidden;
  text-align: center;
  font-weight: bold;
  font-size: 1.5em;
}

#items .panel-heading {
  text-align: center;
  font-weight: bold;
}

#items>.panel {
  margin-top: 80px;
}

#operations {
  padding: 10px;
  text-align: right;
}

#operations a {
  margin: 5px;
}

#items .list-group-item {
  padding: 0;
}



</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="col-md-4" id="categories">
    <div class="panel">
      <div class="panel-heading">
        Item Catalog
      </div>
      <div class="list-group">
  <!--       <a href="#" class="list-group-item list-group-item-success active">
          Cras justo odio
        </a>
        <a href="#" class="list-group-item">Dapibus ac facilisis in</a>
        <a href="#" class="list-group-item">Morbi leo risus</a>
        <a href="#" class="list-group-item">Porta ac consectetur ac</a>
        <a href="#" class="list-group-item">Vestibulum at eros</a> -->

        {% for category in categories %}
        <a href="#" class="list-group-item list-group-item-success">
          <span class="badge"> {{ category.items.count() }}</span>
          <span class="category_name">{{ category.name }}</span>
        </a>
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="col-md-8" id="items">
    <div class="panel panel-default">
      <div class="list-group"></div>
    </div>
    <div id="error_message"></div>
  </div>


</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript">
  $(".list-group a").click(function() {
    $(this).parent().children().removeClass("active");
    $(this).addClass("active");
    var name = jQuery(this).find(".category_name").text();
    var items = $.ajax('/' + name, {
      dataType: 'json'
    }).done(function (data) {
      console.log(data);
      items = data.items;
      var i;
      $("#items .list-group").empty();
      $("#error_message").empty();
      if (items.length == 0) {
        $("#items .list-group").hide();
        $("#error_message").html("<h5>No item under category \"" + name + "\".</h5>");
      } else {
        for (i = 0; i < items.length; i++) {
          console.log(items[i].name);
          // name = items[i].name;
          $("#items .list-group").show();
          
          $("#items .list-group").append(
            $("<div></div>").addClass('list-group-item panel panel-success').attr('id', 'item_' + items[i].id)
            .append($('<div></div>').addClass('panel-heading').html(items[i].name))
            .append(
                $('<div></div>').addClass('wrapper')
                .append(
                  $('<div></div>').addClass('description panel-body').html(items[i].description))
                .append(
                  {% if current_user.is_authenticated() %}
                  
                  $('<div></div>').attr('id', 'operations')
                  .append(
                    $('<a></a>').attr('href', '/' + name + '/' + items[i].name + '/edit').append(
                        "<span class='label label-warning'>Edit</span>")
                  )
                  .append(
                    $('<a></a>').attr('href', '/' + name + '/' + items[i].name + '/delete').append(
                        "<span class='label label-danger'>Delete</span>")
                  )
                  {% endif %}

                )
            )
          );



          // $("#items .list-group").show();
          // $("#items .list-group").append("<li class='list-group-item' id='item_" + items[i].id + "'><div class='panel-body'>"
          // + items[i].name + "</div><div class='wrapper panel-footer'>" + items[i].description + "</div><div class='operations'></div></li>");



        }
        $(".wrapper").hide();
      }
    }).fail(function () {
      $("#items .list-group").hide();
      $("#error_message").html("<h5>Connection failed.</h5>");

    });
    
  });

  $("#items .list-group").on("mouseenter", ".list-group-item", 
    function() {
      $(this).find(".wrapper").fadeIn("slow");
  });
  $("#items .list-group").on("mouseleave", ".list-group-item", 
    function() {
      $(this).find(".wrapper").hide();
  });

</script>

{% endblock %}